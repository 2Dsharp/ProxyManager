<!DOCTYPE html>
<html class="no-js" id="top">
<head>
    <title>ProxyManager Documentation - Changelog</title>

    <meta name="description" content="A proxyManager write in php" />
    <meta name="keywords" content="ProxyManager, proxy, manager, ocramius, Marco Pivetta, php" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600' rel='stylesheet' type='text/css'>
    <link href="https://ocramius.github.io/ProxyManager/css/main.css" rel="stylesheet" />
    <link href="https://ocramius.github.io/ProxyManager/css/highlight.dark.css" rel="stylesheet" />
    <script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body>

<header class="site-header">
<div class="container">
<h1><a href="https://ocramius.github.io/ProxyManager"><img alt="ProxyManager" src="https://ocramius.github.io/ProxyManager/img/block.png" /></a></h1>

<nav class="main-nav" role="navigation">
<ul>
    <li><a href="https://github.com/Ocramius/ProxyManager" target="_blank">Github</a></li>

    </ul>
    <div class="bcms-clearfix"></div>
</nav>
</div>
</header>
<main role="main">
<section class="component-content"><div class="page-title-wrapper">
<div class="container">
    <img src="https://github.com/Ocramius/ProxyManager/raw/master/proxy-manager.png">
    <h2 class="page-title">Proxy Manager</h2>
</div>
</div>

<div class="component-demo" id="live-demo">
    <div class="container">
            <div class="main-wrapper" style="text-align: right">
                <iframe src="http://ghbtns.com/github-btn.html?user=ocramius&amp;repo=ProxyManager&amp;type=fork&amp;count=true&amp;size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="310" height="40"></iframe>

                <iframe src="http://ghbtns.com/github-btn.html?user=ocramius&amp;repo=ProxyManager&amp;type=watch&amp;count=true&amp;size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200" height="40"></iframe>

            </div>
        <div class="bcms-clearfix bcms-clearfix"></div>
    </div>
</div>
<div class="component-info">
<div class="container">

<aside class="sidebar">
    <nav class="spy-nav">
        <ul>
            <li><a href="https://ocramius.github.io/ProxyManager/index.html">Intro</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/lazy-loading-value-holder.html">Virtual Proxy</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/lazy-loading-ghost-object.html">Ghost Object</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/access-interceptor-value-holder.html">Smart Reference</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/access-interceptor-scope-localizer.html">Smart Reference<br/>(fluent safe)</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/null-object.html">Null Objects</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/remote-object.html">Remote Object</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/generator-strategies.html">Code Evaluators</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/tuning-for-production.html">Tuning for Production</a></li>
        </ul>
    </nav>
<div class="bcms-clearfix bcms-clearfix"></div>
<a class="btn btn-action btn-full download-component"
    href="https://ocramius.github.io/ProxyManager/docs/download.html">Download</a>
    <div class="bcms-clearfix"></div>
</aside>

<div class="content">
    
        <p>This is a list of changes/improvements that were introduced in ProxyManager</p>
<h2 id="200">2.0.0</h2>
<h3 id="bc-breaks">BC Breaks</h3>
<p>Please refer to <a href="upgrade.html">the upgrade documentation</a> to see which backwards-incompatible
changes were applied to this release.</p>
<h3 id="new-features">New features</h3>
<h4 id="php-7-support">PHP 7 support</h4>
<p>ProxyManager will now correctly operate in PHP 7 environments.</p>
<h4 id="php-7-return-type-hints">PHP 7 Return type hints</h4>
<p>ProxyManager will now correctly mimic signatures of methods with return type hints:</p>
<pre><code class="language-php">class SayHello
{
    public function hello() : string
    {
        return 'hello!';
    }
}</code></pre>
<h4 id="php-7-scalar-type-hints">PHP 7 Scalar type hints</h4>
<p>ProxyManager will now correctly mimic signatures of methods with scalar type hints</p>
<pre><code class="language-php">class SayHello
{
    public function hello(string $name) : string
    {
        return 'hello, ' . $name;
    }
}</code></pre>
<h4 id="php-56-variadics-support">PHP 5.6 Variadics support</h4>
<p>ProxyManager will now correctly mimic behavior of methods with variadic parameters:</p>
<pre><code class="language-php">class SayHello
{
    public function hello(string ...$names) : string
    {
        return 'hello, ' . implode(', ', $names);
    }
}</code></pre>
<p>By-ref variadic arguments are also supported:</p>
<pre><code class="language-php">class SayHello
{
    public function hello(string ... &amp; $names)
    {
        foreach ($names as &amp; $name) {
            $name = 'hello, ' . $name;
        }
    }
}</code></pre>
<h4 id="constructors-in-proxies-are-not-replaced-anymore">Constructors in proxies are not replaced anymore</h4>
<p>In ProxyManager v1.x, the constructor of a proxy was completely replaced with a method
accepting proxy-specific parameters.</p>
<p>This is no longer true, and you will be able to use the constructor of your objects as
if the class wasn't proxied at all:</p>
<pre><code class="language-php">class SayHello
{
    public function __construct()
    {
        echo 'Hello!';
    }
}

/* @var $proxyGenerator \ProxyManager\ProxyGenerator\ProxyGeneratorInterface */
$proxyClass = $proxyGenerator-&gt;generateProxy(
    new ReflectionClass(SayHello::class),
    new ClassGenerator('ProxyClassName')
);

eval('&lt;?php ' . $proxyClass-&gt;generate());

$proxyName = $proxyClass-&gt;getName();
$object = new ProxyClassName(); // echoes "Hello!"

var_dump($object); // a proxy object</code></pre>
<p>If you still want to manually build a proxy (without factories), a
<code>public static staticProxyConstructor</code> method is added to the generated proxy classes.</p>
<h4 id="friend-classes-support">Friend classes support</h4>
<p>You can now access state of &quot;friend objects&quot; at any time.</p>
<pre><code class="language-php">class EmailAddress
{
    private $address;

    public function __construct(string $address)
    {
        assertEmail($address);

        $this-&gt;address = $address;
    }

    public function equalsTo(EmailAddress $other)
    {
        return $this-&gt;address === $other-&gt;address;
    }
}</code></pre>
<p>When using lazy-loading or access-interceptors, the <code>equalsTo</code> method will
properly work, as even <code>protected</code> and <code>private</code> access are now correctly proxied.</p>
<h4 id="ghost-objects-now-only-lazy-load-on-state-access">Ghost objects now only lazy-load on state-access</h4>
<p>Lazy loading ghost objects now trigger lazy-loading only when their state is accessed.
This also implies that lazy loading ghost objects cannot be used with interfaces anymore.</p>
<pre><code class="language-php">class AccessPolicy
{
    private $policyName;

    /**
     * Calling this method WILL cause lazy-loading, when using a ghost object,
     * as the method is accessing the object's state
     */
    public function getPolicyName() : string
    {
        return $this-&gt;policyName;        
    }

    /**
     * Calling this method WILL NOT cause lazy-loading, when using a ghost object,
     * as the method is not reading any from the object.
     */
    public function allowAccess() : bool
    {
        return false;
    }
}</code></pre>
<h4 id="faster-ghost-object-state-initialization">Faster ghost object state initialization</h4>
<p>Lazy loading ghost objects can now be initialized in a more efficient way, by avoiding
reflection or setters:</p>
<pre><code class="language-php">class Foo
{
    private $a;
    protected $b;
    public $c;
}

$factory = new \ProxyManager\Factory\LazyLoadingGhostFactory();

$proxy = $factory-createProxy(
    Foo::class,
    function (
        GhostObjectInterface $proxy, 
        string $method, 
        array $parameters, 
        &amp; $initializer,
        array $properties
    ) {
        $initializer   = null;

        $properties["\0Foo\0a"] = 'abc';
        $properties["\0*\0b"]   = 'def';
        $properties['c']        = 'ghi';

        return true;
    }
);

$reflectionA = new ReflectionProperty(Foo::class, 'a');
$reflectionA-&gt;setAccessible(true);

var_dump($reflectionA-&gt;getValue($proxy)); // dumps "abc"

$reflectionB = new ReflectionProperty(Foo::class, 'b');
$reflectionB-&gt;setAccessible(true);

var_dump($reflectionB-&gt;getValue($proxy)); // dumps "def"

var_dump($proxy-&gt;c); // dumps "ghi"</code></pre>
<h4 id="skipping-lazy-loaded-properties-in-generated-proxies">Skipping lazy-loaded properties in generated proxies</h4>
<p>Lazy loading ghost objects can now skip lazy-loading for certain properties.
This is especially useful when you have properties that are always available,
such as identifiers of entities:</p>
<pre><code class="language-php">class User
{
    private $id;
    private $username;

    public function getId() : int
    {
        return $this-&gt;id;
    }

    public function getUsername() : string
    {
        return $this-&gt;username;
    }
}

/* @var $proxy User */
$proxy = (new \ProxyManager\Factory\LazyLoadingGhostFactory())-&gt;createProxy(
    User::class,
    function (
        GhostObjectInterface $proxy,
        string $method,
        array $parameters,
        &amp; $initializer,
        array $properties
    ) {
        $initializer   = null;

        var_dump('Triggered lazy-loading!');

        $properties["\0User\0username"] = 'Ocramius';

        return true;
    },
    [
        'skippedProperties' =&gt; [
            "\0User\0id",
        ],
    ]
);

$idReflection = new \ReflectionProperty(User::class, 'id');

$idReflection-&gt;setAccessible(true);
$idReflection-&gt;setValue($proxy, 123);

var_dump($proxy-&gt;getId());       // 123
var_dump($proxy-&gt;getUsername()); // "Triggered lazy-loading!", then "Ocramius"</code></pre>
<h4 id="proxies-are-now-always-generated-on-the-fly-by-default">Proxies are now always generated on-the-fly by default</h4>
<p>Proxies are now automatically generated any time you require them: no configuration
needed. If you want to gain better performance, you may still want to read
the <a href="docs/tuning-for-production.html">tuning for production docs</a>.</p>
<h4 id="proxy-names-are-now-hashed-simplified-signature-is-attached-to-them">Proxy names are now hashed, simplified signature is attached to them</h4>
<p>Proxy classes now have shorter names, as the parameters used to generate them are
hashed into their name. A signature is attached to proxy classes (as a private static
property) so that proxy classes aren't re-used across library updates.
Upgrading ProxyManager will now cause all proxies to be re-generated automatically,
while the old proxy files are going to be ignored.</p>

    </div>
</div>
</div>
</section>
</main>

    <footer class="site-footer" role="contentinfo">
        <div class="container">
            <div class="footer-logos">
                <ul>
                    <li><a href="https://ocramius.github.io/ProxyManager/stability.html">Stability</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/upgrade.html">Upgrade Notes</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/changelog.html">Changelog</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/contributing.html">Contributing</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/docs/credits.html">Credits</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/docs/copyright.html">Copyright</a></li>
                </ul>
            </div>
        </div>

        <div class="bcms-clearfix"></div>
    </footer>
    <div class="bcms-clearfix"></div>
    </body>
</html>
