<!DOCTYPE html>
<html class="no-js" id="top">
<head>
    <title>ProxyManager Documentation - Lazy Loading Ghost Object Proxies</title>

    <meta name="description" content="A proxyManager write in php" />
    <meta name="keywords" content="ProxyManager, proxy, manager, ocramius, Marco Pivetta, php" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600' rel='stylesheet' type='text/css'>
    <link href="https://ocramius.github.io/ProxyManager/css/main.css" rel="stylesheet" />
    <link href="https://ocramius.github.io/ProxyManager/css/highlight.dark.css" rel="stylesheet" />
    <script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body>

<header class="site-header">
<div class="container">
<h1><a href="https://ocramius.github.io/ProxyManager"><img alt="ProxyManager" src="https://ocramius.github.io/ProxyManager/img/block.png" /></a></h1>

<nav class="main-nav" role="navigation">
<ul>
    <li><a href="https://github.com/Ocramius/ProxyManager" target="_blank">Github</a></li>

    </ul>
    <div class="bcms-clearfix"></div>
</nav>
</div>
</header>
<main role="main">
<section class="component-content"><div class="page-title-wrapper">
<div class="container">
    <img src="https://github.com/Ocramius/ProxyManager/raw/master/proxy-manager.png">
    <h2 class="page-title">Proxy Manager</h2>
</div>
</div>

<div class="component-demo" id="live-demo">
    <div class="container">
            <div class="main-wrapper" style="text-align: right">
                <iframe src="http://ghbtns.com/github-btn.html?user=ocramius&amp;repo=ProxyManager&amp;type=fork&amp;count=true&amp;size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="310" height="40"></iframe>

                <iframe src="http://ghbtns.com/github-btn.html?user=ocramius&amp;repo=ProxyManager&amp;type=watch&amp;count=true&amp;size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200" height="40"></iframe>

            </div>
        <div class="bcms-clearfix bcms-clearfix"></div>
    </div>
</div>
<div class="component-info">
<div class="container">

<aside class="sidebar">
    <nav class="spy-nav">
        <ul>
            <li><a href="https://ocramius.github.io/ProxyManager/index.html">Intro</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/lazy-loading-value-holder.html">Virtual Proxy</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/lazy-loading-ghost-object.html">Ghost Object</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/access-interceptor-value-holder.html">Smart Reference</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/access-interceptor-scope-localizer.html">Smart Reference<br/>(fluent safe)</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/null-object.html">Null Objects</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/remote-object.html">Remote Object</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/generator-strategies.html">Code Evaluators</a></li>
            <li><a href="https://ocramius.github.io/ProxyManager/docs/tuning-for-production.html">Tuning for Production</a></li>
        </ul>
    </nav>
<div class="bcms-clearfix bcms-clearfix"></div>
<a class="btn btn-action btn-full download-component"
    href="https://ocramius.github.io/ProxyManager/docs/download.html">Download</a>
    <div class="bcms-clearfix"></div>
</aside>

<div class="content">
    
        <h1 id="lazy-loading-ghost-object-proxies">Lazy Loading Ghost Object Proxies</h1>
<p>A lazy loading ghost object proxy is a ghost proxy that looks exactly like the real instance of the proxied subject,
but which has all properties nulled before initialization.</p>
<h2 id="lazy-loading-with-the-ghost-object">Lazy loading with the Ghost Object</h2>
<p>In pseudo-code, in userland, <a href="http://www.martinfowler.com/eaaCatalog/lazyLoad.html">lazy loading</a> in a ghost object
looks like following:</p>
<pre><code class="language-php">class MyObjectProxy
{
    private $initialized = false;
    private $name;
    private $surname;

    public function doFoo()
    {
        $this-&gt;init();

        // Perform doFoo routine using loaded variables
    }

    private function init()
    {
        if (! $this-&gt;initialized) {
            $data          = some_logic_that_loads_data();

            $this-&gt;name    = $data['name'];
            $this-&gt;surname = $data['surname'];

            $this-&gt;initialized = true;
        }
    }
}</code></pre>
<p>Ghost objects work similarly to virtual proxies, but since they don't wrap around a &quot;real&quot; instance of the proxied
subject, they are better suited for representing dataset rows.</p>
<h2 id="when-do-i-use-a-ghost-object">When do I use a ghost object?</h2>
<p>You usually need a ghost object in cases where following applies</p>
<ul>
<li>you are building a small data-mapper and want to lazily load data across associations in your object graph</li>
<li>you want to initialize objects representing rows in a large dataset</li>
<li>you want to compare instances of lazily initialized objects without the risk of comparing a proxy with a real subject</li>
<li>you are aware of the internal state of the object and are confident in working with its internals via reflection
or direct property access</li>
</ul>
<h2 id="usage-examples">Usage examples</h2>
<p><a href="https://github.com/Ocramius/ProxyManager">ProxyManager</a> provides a factory that creates lazy loading ghost objects.
To use it, follow these steps:</p>
<p>First of all, define your object's logic without taking care of lazy loading:</p>
<pre><code class="language-php">namespace MyApp;

class Customer
{
    private $name;
    private $surname;

    // just write your business logic or generally logic
    // don't worry about how complex this object will be!
    // don't code lazy-loading oriented optimizations in here!
    public function getName() { return $this-&gt;name; }
    public function setName($name) { $this-&gt;name = (string) $name; }
    public function getSurname() { return $this-&gt;surname; }
    public function setSurname($surname) { $this-&gt;surname = (string) $surname; }
}</code></pre>
<p>Then use the proxy manager to create a ghost object of it.
You will be responsible of setting its state during lazy loading:</p>
<pre><code class="language-php">namespace MyApp;

use ProxyManager\Factory\LazyLoadingGhostFactory;
use ProxyManager\Proxy\LazyLoadingInterface;

require_once __DIR__ . '/vendor/autoload.php';

$factory     = new LazyLoadingGhostFactory();
$initializer = function (LazyLoadingInterface $proxy, $method, array $parameters, &amp; $initializer) {
    $initializer   = null; // disable initialization

    // load data and modify the object here
    $proxy-&gt;setName('Agent');
    $proxy-&gt;setSurname('Smith');

    return true; // confirm that initialization occurred correctly
};

$instance = $factory-&gt;createProxy('MyApp\Customer', $initializer);</code></pre>
<p>You can now simply use your object as before:</p>
<pre><code class="language-php">// this will just work as before
echo $proxy-&gt;getName() . ' ' . $proxy-&gt;getSurname(); // Agent Smith</code></pre>
<h2 id="lazy-initialization">Lazy Initialization</h2>
<p>As you can see, we use a closure to handle lazy initialization of the proxy instance at runtime.
The initializer closure signature for ghost objects should be as following:</p>
<pre><code class="language-php">/**
 * @var object  $proxy         the instance the ghost object proxy that is being initialized
 * @var string  $method        the name of the method that triggered lazy initialization
 * @var array   $parameters    an ordered list of parameters passed to the method that
 *                             triggered initialization, indexed by parameter name
 * @var Closure $initializer   a reference to the property that is the initializer for the
 *                             proxy. Set it to null to disable further initialization
 *
 * @return bool true on success
 */
$initializer = function ($proxy, $method, $parameters, &amp; $initializer) {};</code></pre>
<p>The initializer closure should usually be coded like following:</p>
<pre><code class="language-php">$initializer = function ($proxy, $method, $parameters, &amp; $initializer) {
    $initializer = null; // disable initializer for this proxy instance

    // modify the object with loaded data
    $proxy-&gt;setFoo(/* ... */);
    $proxy-&gt;setBar(/* ... */);

    return true; // report success
};</code></pre>
<p>The
<a href="https://github.com/Ocramius/ProxyManager/blob/master/src/ProxyManager/Factory/LazyLoadingGhostFactory.php"><code>ProxyManager\Factory\LazyLoadingGhostFactory</code></a>
produces proxies that implement both the
<a href="https://github.com/Ocramius/ProxyManager/blob/master/src/ProxyManager/Proxy/GhostObjectInterface.php"><code>ProxyManager\Proxy\GhostObjectInterface</code></a>
and the
<a href="https://github.com/Ocramius/ProxyManager/blob/master/src/ProxyManager/Proxy/LazyLoadingInterface.php"><code>ProxyManager\Proxy\LazyLoadingInterface</code></a>.</p>
<p>At any point in time, you can set a new initializer for the proxy:</p>
<pre><code class="language-php">$proxy-&gt;setProxyInitializer($initializer);</code></pre>
<p>In your initializer, you <strong>MUST</strong> turn off any further initialization:</p>
<pre><code class="language-php">$proxy-&gt;setProxyInitializer(null);</code></pre>
<p>or</p>
<pre><code class="language-php">$initializer = null; // if you use the initializer passed by reference to the closure</code></pre>
<h2 id="triggering-initialization">Triggering Initialization</h2>
<p>A lazy loading ghost object is initialized whenever you access any property or method of it.
Any of the following interactions would trigger lazy initialization:</p>
<pre><code class="language-php">// calling a method
$proxy-&gt;someMethod();

// reading a property
echo $proxy-&gt;someProperty;

// writing a property
$proxy-&gt;someProperty = 'foo';

// checking for existence of a property
isset($proxy-&gt;someProperty);

// removing a property
unset($proxy-&gt;someProperty);

// cloning the entire proxy
clone $proxy;

// serializing the proxy
$unserialized = unserialize(serialize($proxy));</code></pre>
<p>Remember to call <code>$proxy-&gt;setProxyInitializer(null);</code> to disable initialization of your proxy, or it will happen more
than once.</p>
<h2 id="proxying-interfaces">Proxying interfaces</h2>
<p>You can also generate proxies from an interface FQCN. By proxying an interface, you will only be able to access the
methods defined by the interface itself, even if the <code>wrappedObject</code> implements more methods. This will anyway save
some memory since the proxy won't contain any properties.</p>
<h2 id="tuning-performance-for-production">Tuning performance for production</h2>
<p>See <a href="tuning-for-production.html">Tuning ProxyManager for Production</a>.</p>

    </div>
</div>
</div>
</section>
</main>

    <footer class="site-footer" role="contentinfo">
        <div class="container">
            <div class="footer-logos">
                <ul>
                    <li><a href="https://ocramius.github.io/ProxyManager/stability.html">Stability</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/upgrade.html">Upgrade Notes</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/contributing.html">Contributing</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/docs/credits.html">Credits</a> | </li>
                    <li><a href="https://ocramius.github.io/ProxyManager/docs/copyright.html">Copyright</a></li>
                </ul>
            </div>
        </div>

        <div class="bcms-clearfix"></div>
    </footer>
    <div class="bcms-clearfix"></div>
    </body>
</html>
